# Paste this on PyKD console after setting hitting a Breakpoint on a Known Function :)

with open(r"c:\temp.txt", "wt") as f:
    num_call = 200
    space = 2
    while num_call > 0:
        disasm_line = pykd.disasm().disasm()
        instruction = disasm_line.split()[2]
        if instruction == "call":
            r = dbgCommand("r")
            print r.split("\n")[3]
            num_call = num_call - 1
            space += 2
            try:
                f.write("%s%s -- %s\n" % (space * " ", disasm_line,r.split("\n")[3]))
            except UnicodeEncodeError:
                f.write("%s%s\n" % (space * " ", r.split("\n")[3]))
            trace()
        else:
            if instruction == "ret":
                space -= 2
            trace()
